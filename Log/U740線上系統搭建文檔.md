# U740線上系統搭建文檔

### 樹莓派

#### 0. 安裝系統

從[官網](https://www.raspberrypi.org/)下載相關軟件，點擊Computers->Software。	

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307110441584.png" alt="image-20220307110441584" style="zoom: 33%;" />

進入頁面後，在「Install Raspberry Pi OS using Raspberry Pi Imager」標題下方，可以看到不同系統的下載連結(此處以Windows為例)，根據自己的系統點擊下載Imager的安裝檔案。下載完成後安裝即可。

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307110734492.png" alt="image-20220307110734492" style="zoom:33%;" />

將SD卡利用讀卡器連接到你的裝置上，並打開Raspberry Pi Imager。

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307111054624.png" alt="image-20220307111054624" style="zoom: 67%;" />

先進行格式化。先點擊選擇操作系統，選擇擦除。

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307111134506.png" alt="image-20220307111134506" style="zoom:50%;" />

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307111230129.png" alt="image-20220307111230129" style="zoom: 150%;" />

然後選擇相應的SD卡

![image-20220307111304955](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307111304955.png)

點擊燒錄。

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307111332730.png" alt="image-20220307111332730" style="zoom:67%;" />

點選"是"。



<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307111510682.png" alt="image-20220307111510682" style="zoom:67%;" />

等待擦除，擦除完畢後點擊繼續。

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307111546906.png" alt="image-20220307111546906" style="zoom:67%;" /><img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307111558570.png" alt="image-20220307111558570" style="zoom:67%;" />

此時可以安裝操作系統，重新選擇適合的操作系統，此處以安裝Legacy版本為例。

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307112234851.png" alt="image-20220307112234851" style="zoom: 80%;" /><img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307112249497.png" alt="image-20220307112249497" style="zoom:80%;" />

按照剛才的操作，重新選擇SD卡，並進行燒錄。點選右下角的齒輪可以進行高級設置，如開啟SSH服務，設置帳號密碼，WIFI等等。如果沒有顯示器需要遠程開機的話，建議在這裏進行設置。

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307112414786.png" alt="image-20220307112414786" style="zoom:67%;" /><img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307113441090.png" alt="image-20220307113441090" style="zoom:67%;" />

點擊燒錄，等待燒錄。安裝完成後把SD卡插到樹莓派上。

<img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307113515341.png" alt="image-20220307113515341" style="zoom:67%;" /><img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220307115405898.png" alt="image-20220307115405898" style="zoom:67%;" />

#### 1. 啟動樹莓派

對於開機設定，可以有兩種選擇

1. 如果有顯示器，直接接上，再接上電源線，鍵盤，鼠標等設備開機進行設置。

2. 如果沒有顯示器，便需要使用ssh來連接，

   首先可以利用網線來連接WIFI，這裏是使用路由器來作為初始連接。

   首先在SD卡的`/boot`分區裏添加配置文件`wpa_supplicant.conf`、並添加空文件`ssh`以讓系統啟動ssh服務。

   ```
   country=CN
   ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
   update_config=1
   network={
       ssid="your_wifi_ssid"
       psk="your_wifi_pwd"
       key_mgmt=WPA-PSK
       priority=1
   }
   ```

   ```
   country=CN
   ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
   update_config=1
   
   network={
           ssid="Tsinghua-Secure"
           proto=RSN
           key_mgmt=WPA-EAP
           pairwise=CCMP
           eap=PEAP
           identity="username"
           password="pwd"
           phase2="auth=MSCHAPV2"
           priority=9
   }
   ```

3. 把SD卡插到樹莓派上，接上電源

4. 等待樹莓派開機，之後可以利用手機軟件"Fing"工具查看樹莓派的IP地址。

5. 利用ssh登陸樹莓派，初始用戶名預設為pi，成功登入。

   ![image-20220308113317665](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220308113317665.png)

6. 如果之後希望不透過密碼更安全登入，可以利用`ssh-keygen -t rsa -f ~/.ssh/rpi-test`生成公鑰，利用公鑰登入

   ```
   $ ssh-keygen -t rsa -f ~/.ssh/rpi-test
   Generating public/private rsa key pair.
   Enter passphrase (empty for no passphrase):
   Enter same passphrase again:
   Your identification has been saved in /c/Users/user/.ssh/rpi-test
   Your public key has been saved in /c/Users/user/.ssh/rpi-test.pub
   The key fingerprint is:
   SHA256:yu7mY/3ChKJn49dLjR6+ef24a2DVNiXEAMUYUYgGgLw user@MSI
   The key's randomart image is:
   +---[RSA 3072]----+
   | . ..... .+X++.  |
   |  o     o o . o .|
   |   .   .     . o |
   |  E         . +  |
   |       .S  . . . |
   |    .....oo      |
   |   . .o=+..o     |
   |  . +.=+=o. o.   |
   |   +.B+.**..++.  |
   +----[SHA256]-----+
   ```

7. cd到`~/.ssh`目錄下，

   ```
   $ ls
   id_rsa      id_rsa~      known_hosts.old  rpi-test.pub
   id_rsa.pub  known_hosts  rpi-test
   ```

8. 完成 SSH key 的產生後，透過 `ssh-copy-id` 的指令將 public key 複製到遠端的樹莓派上，之後便可以直接`ssh pi@your_ip`登入。

#### 2. 遠端桌面

如果需要遠端桌面，在Windows下可以通过远程桌面连接树莓派图形界面

1. 首先通過在樹莓派上安裝xrdp, `sudo apt-get install xrdp`

2. 在Windows上通過遠端桌面連線連接樹莓派的圖形化界面



GPIO控制開關

### U740

