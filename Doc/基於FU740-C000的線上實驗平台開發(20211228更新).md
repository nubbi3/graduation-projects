# 基於**FU740-C000**的線上實驗平台開發

## 背景動機

考慮到現今計算機系的原理課與實驗環節幾乎是密不可分的，就比如計算機組成原理課就有一個線上的硬件仿真實驗平台讓同學們能夠在板子上跑自己的程序，以加強學習成效以及同學們的動手能力，讓同學們在做實驗的過程中學習相關知識。同樣是四大原理課中的操作系統課，雖然授課的內容知識點十分完整，但卻缺乏一個能夠讓同學們與實際板子打交道的機會，使得同學們並不能在實際的板子中培養動手解決問題的能力。因此，我希望操作系統課也能夠擁有一個線上實驗平台，讓同學們能夠從實際中學習相關知識，使知識更為扎實，並且能夠提升課程的多樣性以及培養同學們發現問題以及解決實際問題的能力。另外，在疫情的情況下，線上實驗平台更顯得有價值。能夠讓學生們安全地，不用到實驗室都能夠利用實際板子來進行實驗學習。

## 目標(初步設想)

### 線上平台基本功能

- 具備登入界面、調試界面

  - 盡量找現成的，減少工作量。
  - 可考慮用GitLab賬號登入
  - 分配给用户的实验虚拟机环境访问（基于公钥和私钥的ssh的访问控制）

- 在調試界面上能夠與真實板子進行交互（能夠把用戶的輸入傳到板子上、能夠輸出數據）

  - 能夠編譯/調試代碼
  - 测例积累、编译報错、浏览代码、输出调试信息和中间变量
  - 在线调试工具的引入
  - 编译的符号信息辅助（堆栈信息的符号展现）

- 能夠加載文件、驅動程序

- 能夠保存輸出數據到本地

### 更具體需要實現的功能

- 可能需要維護一個數據庫，儲存用戶信息
- 实验资源管理
  - 可能需要設計开发板間的使用調度
  - 实验用docker
- 需要把調試界面連接到實際的板子中（遠程控制）
- 對板子的功能進行更多擴展
- 实验过程数据采集和分析
  - 每个用户的操作日志
  - 统计信息（容易出错的位置、编译次数、第一次成功编译的时间、统计信息展现等））
- 实验数据获取和展现
  - 源代码(可能的工作)
  - 数据上传和下载(現成)
  - 数据组织和展现(可能的工作、提示、報錯)

最終形成一个可演示和试用的原型系统

## 整體設計框架

![image-20211226230858091](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20211226230858091.png)

## 困難與挑戰

第一次需要從驅動開始如此底層的使用板子，需要從零學起FU740的使用方法，且需要編寫前後端。對於前後端，以及如何部署線上平台都是不熟識的，因此難度與工作量都比較大。

### 第一部分：**FU740-C000**

- 查閱板子的使用手冊，學習板子的相關知識，包括驅動流程，中斷，遠程控制等等
- 要先復現學長學姐們已經完成的工作再進行下一步的開發
- 目前與電腦端控制交互還未完全調通，需要先把板子與電腦端交互調穩定

### 第二部分：線上平台

- 需要學習如何搭建一個簡單的數據庫

- 需要學習如何編寫具備登入功能的網頁前後端
- 需要學習如何部署線上平台

## 計劃使用框架

計劃使用Moodle作為線上平台的基礎框架

Moodle的優點：

- 開源、世界各地的大學都在使用
- 多插件，且插件功能廣

## 計劃安排

1-3週：復現前人的工作，並學習板子相關內容，爭取在兩週內調穩定板子與電腦間的交互並開展後續工作。

4-6週：落實並搭建基本網頁框架，完成基本功能：登入功能，能夠顯示板子訊息，簡易數據庫。

7-8週：完成文件加載功能，並具備選板子功能。

9-10週：能夠在實驗平台上與板子進行基本交互。

11-12週：能夠在實驗平台上顯示板子的輸出。

13-14週：其他可能的擴展功能。

15-16週：最後調整，並準備答辯資料。

## 參考資料

1. FU7400-C000官方文檔：[FU740-C000 Manual v1p3 (prismic.io)](https://sifive.cdn.prismic.io/sifive/de1491e5-077c-461d-9605-e8a0ce57337d_fu740-c000-manual-v1p3.pdf)
2. 田凯夫學長的FU7400使用文檔：[Boot S7 - OS on Hifive Unmatched (gitbook.io)](https://kaifu6821.gitbook.io/os-on-hifive-unmatched/boot-s7)
3. 哈工大的一個開源Moodle，具備OJ, 查重, GitHub Assignment：[Moodle Dev in HIT (github.com)](https://github.com/hit-moodle)
4. CodeRunner, Moodle的一個插件，能夠提供代碼編譯功能[Moodle plugins directory: CodeRunner](https://moodle.org/plugins/qtype_coderunner) [trampgeek/moodle-qtype_coderunner: CodeRunner: A moodle quiz question type that runs student-submitted program code in a sandbox to check if it satisfies a given set of tests. (github.com)](https://github.com/trampgeek/moodle-qtype_coderunner)
5. VPL: [Moodle plugins directory: Virtual Programming Lab](https://moodle.org/plugins/mod_vpl)

